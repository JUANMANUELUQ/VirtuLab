<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Inscripción a Curso - DevDemy</title>
  <link rel="stylesheet" href="styles.css" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
  <style>
    /* center the form card on an orange page background */
    html, body {
      height: 100%;
    }
    body {
      margin: 0;
      background: #ffa800; /* make the page background orange - the card is the main content */
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      padding: 1rem 1rem;
      overflow: auto; /* allow page scrolling if needed */
    }

    /* single card centered and scrollable internally when needed */
    .card {
      background: #ffffff;
      width: 100%;
      max-width: 1050px; /* increased card width for wider forms on large screens */
      margin: 0 auto;
      max-height: calc(100vh - 4rem);
      overflow: auto;
      -webkit-overflow-scrolling: touch;
      border-radius: 10px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.12);
    }

    /* Custom primary for Unirme al curso */
    .btn-primary {
      background: #ffa800;
      border: none;
      color: #fff;
    }
    .btn-primary:hover, .btn-primary:focus {
      background: #ffb84d; /* lighter shade on hover/focus */
      color: #fff;
    }

    /* Ensure card stays white and readable on orange background */
    .card { background: #ffffff; }

    /* Form title uses the brand color */
    .card-body .h4 { color: #ffa800; }
    /* Equal-width buttons (desktop) */
    .btn-equal { width: 180px; }
    @media (max-width: 480px) { .btn-equal { width: 100%; } }
    /* Show red asterisk for the required visible fields (all except comentarios) */
    label[for="tipoDocumento"]::after,
    label[for="numeroDocumento"]::after,
    label[for="nombres"]::after,
    label[for="apellidos"]::after,
    label[for="email"]::after,
    label[for="celular"]::after,
    label[for="curso"]::after {
      content: " *";
      color: #dc3545; /* bootstrap danger red */
      font-weight: 700;
      margin-left: 2px;
    }


    /* Estilos para el modal */
    .modal {
      display: none; 
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.5);
    }

    .modal-content {
      background-color: #fff;
      margin: 15% auto;
      padding: 20px;
      border-radius: 10px;
      width: 400px;
      text-align: center;
      box-shadow: 0 5px 15px rgba(0,0,0,0.3);
      animation: fadeIn 0.4s;
    }

    .close {
      color: #aaa;
      float: right;
      font-size: 24px;
      font-weight: bold;
      cursor: pointer;
    }

    .close:hover {
      color: #000;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: scale(0.9); }
      to { opacity: 1; transform: scale(1); }
    }

    .btn {
      padding: 10px 20px;
      background: #f57c00;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 16px;
    }

    .btn:hover {
      background: #e65100;
    }


  </style>
</head>
<body>

  <!-- Modal -->
  <div id="registroModal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="cerrarModal()">&times;</span>
      <h2>Registro Exitoso ✅</h2>
      <p>Te has registrado correctamente en el curso.</p>
      <p>Revisa tu correo, pronto recibirás más información.</p>
      <button class="btn" onclick="cerrarModal()">Aceptar</button>
    </div>
  </div>

  <main>

    <div class="card shadow-sm">
      <div class="card-body">
        <h1 class="h4 mb-3">Formulario de Inscripción</h1>
        <p class="form-note">Rellena los datos para unirte. Campos con <span class="text-danger">*</span> son obligatorios.</p>

        <form id="inscripcionForm" class="needs-validation" novalidate>
          <div class="row g-3">
            <div class="col-md-6">
              <label for="tipoDocumento" class="form-label required"><i class="bi bi-card-text me-1"></i>Tipo de documento</label>
              <select id="tipoDocumento" name="tipoDocumento" class="form-select" required>
                <option value="">Seleccione el Tipo de Documento</option>
                <option value="tarjeta">Tarjeta de Identidad</option>
                <option value="cc">Cédula de Ciudadanía</option>
                <option value="ce">Cédula de Extranjería</option>
              </select>
              <div class="invalid-feedback">Selecciona un tipo de documento.</div>
            </div>

            <div class="col-md-6">
              <label for="numeroDocumento" class="form-label required"><i class="bi bi-123 me-1"></i>Número de documento</label>
              <input type="text" inputmode="numeric" id="numeroDocumento" name="numeroDocumento" class="form-control" placeholder="Ej: 12345678" required minlength="6" maxlength="10" pattern="^[0-9]+$">
              <div class="invalid-feedback">Ingresa solo números (5–15 dígitos).</div>
            </div>

            <div class="col-md-6">
              <label for="nombres" class="form-label required"><i class="bi bi-person me-1"></i>Nombres</label>
              <input type="text" id="nombres" name="nombres" class="form-control" placeholder="Tus nombres" required pattern="^[A-Za-zÀ-ÿñÑ' -]{2,}$" minlength="2">
              <div class="invalid-feedback">Ingresa tus nombres (solo letras, espacios y guiones).</div>
            </div>

            <div class="col-md-6">
              <label for="apellidos" class="form-label required"><i class="bi bi-person me-1"></i>Apellidos</label>
              <input type="text" id="apellidos" name="apellidos" class="form-control" placeholder="Tus apellidos" required pattern="^[A-Za-zÀ-ÿñÑ' -]{2,}$" minlength="2">
              <div class="invalid-feedback">Ingresa tus apellidos (solo letras, espacios y guiones).</div>
            </div>

            <div class="col-md-6">
              <label for="email" class="form-label required"><i class="bi bi-envelope me-1"></i>Correo electrónico</label>
              <input type="email" id="email" name="email" class="form-control" placeholder="nombre@ejemplo.com" required>
              <div class="invalid-feedback">Ingresa un correo válido.</div>
            </div>

            <div class="col-md-6">
              <label for="celular" class="form-label required"><i class="bi bi-phone me-1"></i>Número de celular</label>
              <input type="tel" id="celular" name="celular" class="form-control" placeholder="Ej: +57 3001234567" required pattern="^[+0-9()\s-]{7,20}$">
              <div class="invalid-feedback">Ingresa un número válido (7–20 caracteres; puede incluir +, espacios o guiones).</div>
            </div>

            <div class="col-12">
              <label for="curso" class="form-label required"><i class="bi bi-book me-1"></i>Curso</label>
              <select id="curso" name="curso" class="form-select" required>
                <option value="">Selecciona el curso de interés...</option>
                <option>Matemáticas generales</option>
                <option>Cálculo</option>
                <option>Diseño gráfico</option>
                <option>Física</option>
                <option>Inglés académico</option>
                <option>Programación básica (Python)</option>
                <option>Estadística aplicada</option>
                <option>Investigación y metodología</option>
                <option>Inteligencia artificial básica</option>
                <option>Bases de datos</option>
                <option>Redes y comunicaciones</option>
                <option>Economía para ingenieros</option>
                <option>Química práctica</option>
                <option>Habilidades blandas y liderazgo</option>
              </select>
              <div class="invalid-feedback">Selecciona al menos un curso.</div>
            </div>
            
            <div class="form-check">
              <input class="form-check-input" type="checkbox" id="terminos" required>
              <label class="form-check-label" for="terminos">
                Acepto los 
                <a href="terminosCondiciones.html" target="_blank">términos y condiciones</a>
              </label>
            </div>

            <div class="col-12 d-flex justify-content-between align-items-center">
              <div>
                
              </div>
              <div style="display:flex;gap:0.5rem;">
                <button class="btn btn-secondary me-2 btn-equal" type="reset">Limpiar</button>
                <button id="envio" class="btn btn-primary btn-equal" type="submit">Unirme al curso</button>
              </div>
            </div>
          </div>
        </form>

        <div id="mensajeSalida" class="mt-4" aria-live="polite"></div>
      </div>
  </main>

  <script src="script.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    verificarEntradaFormulario();
    // Preserve the existing preselect + validation + submit logic.
    (function preselectFromQuery(){
      try {
        const params = new URLSearchParams(window.location.search);
        const cursoParam = params.get('curso');
        if (!cursoParam) return;
        const cursoDecoded = decodeURIComponent(cursoParam);
        const select = document.getElementById('curso');
        if (!select) return;
        // Buscar option por texto o por value
        let matched = Array.from(select.options).find(o => o.value === cursoDecoded || o.text === cursoDecoded);
            if (matched) {
              select.value = matched.value || matched.text;
              select.classList.add('is-valid');
              select.disabled = true;
            } else {
              const opt = document.createElement('option');
              opt.text = cursoDecoded;
              opt.value = cursoDecoded;
              opt.selected = true;
              select.appendChild(opt);
              select.classList.add('is-valid');
              select.disabled = true;
            }
      } catch (e) {
        console.error('preselectFromQuery error', e);
      }
    })();

    
    const form = document.getElementById('inscripcionForm');
    const salida = document.getElementById('mensajeSalida');

    // Field references (keep names/IDs used elsewhere)
    const tipoDocumento = document.getElementById('tipoDocumento');
    const numeroDocumento = document.getElementById('numeroDocumento');
    const nombres = document.getElementById('nombres');
    const apellidos = document.getElementById('apellidos');
    const email = document.getElementById('email');
    const celular = document.getElementById('celular');
    const curso = document.getElementById('curso');
    const terminos = document.getElementById('terminos');

    // Regex validators
    const nameRegex = /^[A-Za-zÀ-ÿñÑ' -]{2,}$/;
    const docRegex = /^[0-9]{5,15}$/; // only digits 5-15
    const phoneRegex = /^[+0-9()\s-]{7,20}$/;

    function checkField(field, testFn) {
      const valid = testFn(field.value.trim());
      field.classList.toggle('is-valid', valid);
      field.classList.toggle('is-invalid', !valid);
      return valid;
    }

    numeroDocumento.addEventListener('input', () => checkField(numeroDocumento, v => docRegex.test(v)));
    nombres.addEventListener('input', () => checkField(nombres, v => nameRegex.test(v)));
    apellidos.addEventListener('input', () => checkField(apellidos, v => nameRegex.test(v)));
    email.addEventListener('input', () => checkField(email, v => email.checkValidity()));
    celular.addEventListener('input', () => checkField(celular, v => phoneRegex.test(v)));
    tipoDocumento.addEventListener('change', () => checkField(tipoDocumento, v => tipoDocumento.value !== ''));
    curso.addEventListener('change', () => checkField(curso, v => curso.value !== ''));
    terminos.addEventListener('change', () => {
      if (terminos.checked) {
        terminos.classList.remove('is-invalid');
        terminos.classList.add('is-valid');
      } else {
        terminos.classList.remove('is-valid');
        terminos.classList.add('is-invalid');
      }
    });

    form.addEventListener('submit', function (event) {
      event.preventDefault();
      event.stopPropagation();

      let valid = true;
      if (!checkField(tipoDocumento, v => tipoDocumento.value !== '')) valid = false;
      if (!checkField(numeroDocumento, v => docRegex.test(v))) valid = false;
      if (!checkField(nombres, v => nameRegex.test(v))) valid = false;
      if (!checkField(apellidos, v => nameRegex.test(v))) valid = false;
      if (!checkField(email, v => email.checkValidity())) valid = false;
      if (!checkField(celular, v => phoneRegex.test(v))) valid = false;
      if (!checkField(curso, v => curso.value !== '')) valid = false;
      if (!checkField(curso, v => curso.value !== '')) valid = false;
      if (!terminos.checked) {
        valid = false;
      }

      form.classList.add('was-validated');

      if (!valid) {
        salida.innerHTML = '<div class="alert alert-danger" role="alert">Hay errores en el formulario. Revisa los campos marcados en rojo.</div>';
        salida.scrollIntoView({behavior: 'smooth'});
        return;
      } else {
        const nombres = document.getElementById('nombres').value;
        const apellidos = document.getElementById('apellidos').value;
        const nombreCompleto=nombres.trim()+" "+apellidos.trim();
        const email = document.getElementById('email').value;
        mostrarModal();
        getUserIP().then(ip => {
            enviarAccion('Envio',nombreCompleto,email,ip)
        });
      }

      // Build summary (kept for debugging if needed)
      const resumen = `\nTipo documento: ${tipoDocumento.options[tipoDocumento.selectedIndex].text}\nDocumento: ${numeroDocumento.value}\nNombre: ${nombres.value} ${apellidos.value}\nCorreo: ${email.value}\nCelular: ${celular.value}\nCurso: ${curso.value}`;

      // Do not show an on-page notification; keep behavior silent and reset the form.
      form.reset();
      form.classList.remove('was-validated');
      [numeroDocumento, nombres, apellidos, email, celular, tipoDocumento, curso].forEach(f => f.classList.remove('is-valid'));
    }, false);

    form.addEventListener('reset', () => {
      // preserve curso selection and disabled state across reset
      const cursoValue = curso.value;
      const cursoDisabled = curso.disabled;
      setTimeout(() => {
        form.classList.remove('was-validated');
        [numeroDocumento, nombres, apellidos, email, celular, tipoDocumento].forEach(f => {
          f.classList.remove('is-valid');
          f.classList.remove('is-invalid');
        });
        // restore curso value and disabled state
        try {
          curso.value = cursoValue;
          curso.disabled = cursoDisabled;
        } catch (e) { /* ignore */ }
        salida.innerHTML = '';
      }, 0);
    });

    // Función para mostrar el modal
    function mostrarModal() {
      document.getElementById("registroModal").style.display = "block";
    }

    // Función para cerrar el modal
    function cerrarModal() {
      document.getElementById("registroModal").style.display = "none";
    }

    // Cierra el modal si se hace clic fuera del contenido
    window.onclick = function(event) {
      let modal = document.getElementById("registroModal");
      if (event.target == modal) {
        modal.style.display = "none";
      }
    }

  </script>
</body>
</html>
